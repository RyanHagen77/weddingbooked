{% load static %}
<!-- Schedule Modal -->
<div class="modal fade" id="scheduleModal" tabindex="-1" role="dialog" aria-labelledby="scheduleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="scheduleModalLabel">Add or Update Schedule</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="scheduleForm" method="post" action="{% url 'payments:create_or_update_schedule' contract_id=contract.contract_id %}">
          <input type="hidden" name="recalculate" id="recalculateFlag" value="true">
          {% csrf_token %}
          {{ schedule_payment_formset.management_form }}
          <hr>
          <!-- Optional separate schedule form -->
          {{ schedule_form.as_p }}
          <hr>

          <!-- Empty Payment Form (used for cloning new schedule entries) -->
          <div class="schedule-payment-form empty-schedule-payment-form" style="display: none;">
            {{ schedule_payment_formset.empty_form.as_p }}
          </div>

          <!-- Payment Schedule Entries -->
          <div id="paymentScheduleEntries">
            {% for form in schedule_payment_formset %}
              <div class="schedule-payment-form mb-3">
                <div class="form-check form-check-inline">
                  <!-- We remove inline onclick; this checkbox will be targeted by our module -->
                  <input type="checkbox" class="form-check-input edit-toggle" id="edit_{{ forloop.counter }}">
                  <label for="edit_{{ forloop.counter }}" class="form-check-label ml-2 mb-0">Enable Editing</label>
                </div>
                <div class="form-fields mt-2" id="form_fields_{{ forloop.counter }}">
                  {{ form.as_p }}
                </div>
                <hr>
              </div>
            {% endfor %}
          </div>

          <!-- Button for adding a new schedule entry -->
          <button type="button" id="addEntryBtn" class="btn btn-dusty-pink mt-2">
            Add Payment Entry
          </button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-close" data-dismiss="modal">Close</button>
        <!-- Save Changes button with an ID for our module to attach a listener -->
        <button type="submit" id="saveChangesBtn" class="btn btn-dusty-pink" form="scheduleForm">
          Save Changes
        </button>
      </div>
    </div>
  </div>
</div>
