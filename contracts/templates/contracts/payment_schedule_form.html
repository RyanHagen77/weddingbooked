<!-- contracts/payment_schedule_form.html -->
<form id="scheduleForm" method="post" action="{% url 'contracts:create_or_update_schedule' contract_id=contract.contract_id %}">
    {% csrf_token %}
    <input type="hidden" name="next" value="{{ request.path }}#payments">
    {{ schedule_payment_formset.management_form }}  <!-- This renders TOTAL_FORMS for the payment schedule -->
    <hr>  <!-- Divider between contract number and schedule type -->
    {{ schedule_form.as_p }}
    <hr>  <!-- Divider between schedule type and payment entries -->
    <!-- Empty Payment Form -->
    <div class="payment-form empty-payment-form">
        {{ schedule_payment_formset.empty_form.as_p }}
    </div>
    <hr>  <!-- Divider between empty payment form and existing payment entries -->
    <div id="paymentScheduleEntries">
        {% for form in schedule_payment_formset %}
            <div class="payment-form mb-3">  <!-- Ensure each form wrapper has the payment-form class -->
                <div class="form-check form-check-inline">
                    <input type="checkbox" class="form-check-input edit-toggle" id="edit_{{ forloop.counter }}" onclick="toggleEdit(this)">
                    <label for="edit_{{ forloop.counter }}" class="form-check-label ml-2 mb-0">Enable Editing</label>
                </div>
                <div class="form-fields mt-2" id="form_fields_{{ forloop.counter }}">
                    {{ form.as_p }}
                </div>
            </div>
            <hr>  <!-- Divider between each payment entry -->
        {% endfor %}
    </div>
</form>

<script>
function toggleEdit(checkbox) {
    var formFields = checkbox.closest('.payment-form').querySelector('.form-fields');
    var inputs = formFields.querySelectorAll('input, select, textarea');

    inputs.forEach(function(input) {
        input.disabled = !checkbox.checked;
    });
}

// Disable all form fields initially
document.addEventListener('DOMContentLoaded', function() {
    var editToggles = document.querySelectorAll('.edit-toggle');

    editToggles.forEach(function(toggle) {
        toggleEdit(toggle);
    });
});
</script>
