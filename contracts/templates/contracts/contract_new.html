<!DOCTYPE html>
<html lang="en">
{% extends "base.html" %}
{% load static %}

{% block head %}
<head>
    <title>New Contract</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Include Bootstrap Datepicker CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <!-- Include your custom CSS file -->
    <link rel="stylesheet" href="{% static 'users/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'contracts/styles.css' %}">
    <style>
        .form-section {
            display: flex;
            margin: 40px;
            padding: 15px;
            border: 1px solid #ddd;
            background-color: #f9f9f9; /* Light gray background */
        }
        .left-column, .right-column {
            flex: 1;
        }
        .error {
            color: red;
            font-size: 0.875em;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
{% endblock head %}

{% block content %}
<body>
    <div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">Form Error</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <ul id="errorList"></ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <form id="contractForm" method="POST" novalidate>
        {% csrf_token %}
        <div class="form-section-container">
            <div class="new-contract-form">
                <div class="left-column">
                    <h5>New Contract</h5>
                    <div>
                        {{ contract_form.is_code_92.label_tag }} {{ contract_form.is_code_92 }}
                    </div>
                    <div>
                        {{ contract_form.event_date.label_tag }} {{ contract_form.event_date }}
                        {% if contract_form.event_date.errors %}
                            <div class="error">{{ contract_form.event_date.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        {{ contract_form.location.label_tag }} {{ contract_form.location }}
                        {% if contract_form.location.errors %}
                            <div class="error">{{ contract_form.location.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        {{ contract_form.status.label_tag }} {{ contract_form.status }}
                        {% if contract_form.status.errors %}
                            <div class="error">{{ contract_form.status.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        {{ contract_form.coordinator.label_tag }} {{ contract_form.coordinator }}
                        {% if contract_form.coordinator.errors %}
                            <div class="error">{{ contract_form.coordinator.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        {{ contract_form.csr.label_tag }} {{ contract_form.csr }}
                        {% if contract_form.csr.errors %}
                            <div class="error">{{ contract_form.csr.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        {{ contract_form.lead_source_category.label_tag }} {{ contract_form.lead_source_category }}
                    </div>
                    <div>
                        {{ contract_form.lead_source_details.label_tag }} {{ contract_form.lead_source_details }}
                    </div>
                    <div>
                        {{ client_form.primary_contact.label_tag }} {{ client_form.primary_contact }}
                        {% if client_form.primary_contact.errors %}
                            <div class="error">{{ client_form.primary_contact.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        {{ client_form.partner_contact.label_tag }} {{ client_form.partner_contact }}
                    </div>
                    <div>
                        {{ client_form.primary_email.label_tag }} {{ client_form.primary_email }}
                        {% if client_form.primary_email.errors %}
                            <div class="error">{{ client_form.primary_email.errors }}</div>
                        {% endif %}
                    </div>
                    <div>
                        {{ client_form.primary_phone1.label_tag }} {{ client_form.primary_phone1 }}
                        {% if client_form.primary_phone1.errors %}
                            <div class="error">{{ client_form.primary_phone1.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="right-column">
                    <div>
                        {{ contract_form.bridal_party_qty.label_tag }} {{ contract_form.bridal_party_qty }}
                    </div>
                    <div>
                        {{ contract_form.guests_qty.label_tag }} {{ contract_form.guests_qty }}
                    </div>
                    <div>
                        {{ contract_form.ceremony_site.label_tag }} {{ contract_form.ceremony_site }}
                    </div>
                    <div>
                        {{ contract_form.ceremony_city.label_tag }} {{ contract_form.ceremony_city }}
                    </div>
                    <div>
                        {{ contract_form.ceremony_state.label_tag }} {{ contract_form.ceremony_state }}
                    </div>
                    <div>
                        {{ contract_form.reception_site.label_tag }} {{ contract_form.reception_site }}
                    </div>
                    <div>
                        {{ contract_form.reception_city.label_tag }} {{ contract_form.reception_city }}
                    </div>
                    <div>
                        {{ contract_form.reception_state.label_tag }} {{ contract_form.reception_state }}
                    </div>
                    <div>
                        {{ contract_form.old_contract_number.label_tag }} {{ contract_form.old_contract_number }}
                    </div>
                    <input type="submit" value="Submit" class="btn btn-primary">
                </div>
            </div>
        </div>
    </form>

    <script>
        $(document).ready(function() {
            $('#contractForm').on('submit', function(event) {
                event.preventDefault(); // Prevent the form from submitting normally

                let form = $(this);
                let data = form.serialize();
                let url = form.attr('action');

                $.ajax({
                    url: url,
                    type: 'POST',
                    data: data,
                    success: function(response) {
                        // If successful, submit the form normally or handle success logic
                        form.off('submit').submit();
                    },
                    error: function(response) {
                        // Display errors in the modal
                        let errors = response.responseJSON.errors;
                        let errorList = $('#errorList');
                        errorList.empty();

                        $.each(errors, function(key, value) {
                            errorList.append('<li>' + key + ': ' + value.join(', ') + '</li>');
                        });

                        $('#errorModal').modal('show');
                    }
                });
            });
        });
    </script>
</body>
{% endblock content %}
</html>
