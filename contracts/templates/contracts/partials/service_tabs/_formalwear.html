<!-- Formalwear Tab Content -->
<div class="tab-pane fade" id="formalwear">
    <div class="row">
        <div class="col-12">
            <div id="formalwear-section" class="mt-4">
                <form method="post" action="{% url 'formalwear:save_formalwear' id=contract.contract_id %}" id="formalwear-form">
                    {% csrf_token %}
                    {% load app_filters %}
                    <input type="hidden" id="contract-id" value="{{ contract.contract_id }}">
                    {{ formalwear_formset.management_form }}
                    <table id="formalwear-table" class="table table-bordered table-hover">
                        <thead class="table-bordered">
                            <tr>
                                <th class="formalwear-column" style="width: 20%;">Formalwear</th>
                                <th class="type-column" style="width: 5%;">Type</th>
                                <th class="size-column" style="width: 5%;">Size</th>
                                <th class="quantity-column" style="width: 13%;">Qty</th>
                                <th class="rental-price-column" style="width: 12%;">Rental Price</th>
                                <th class="deposit-column" style="width: 12%;">Deposit</th>
                                <th class="return-date-column" style="width: 15%;">Return Date</th>
                                <th class="added-on-column" style="width: 10%;">Added On</th>
                                <th class="remove-column" style="width: 8%;">Remove</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for form in formalwear_formset %}
                            <tr class="formalwear-row">
                                <td>
                                    {{ form.id.as_hidden }}
                                    <select name="{{ form.formalwear_product.html_name }}" id="{{ form.formalwear_product.id_for_label }}" class="formalwear-dropdown">
                                        <option value="">Select Formalwear</option>
                                        {% for product in form.fields.formalwear_product.queryset %}
                                        <option value="{{ product.id }}"
                                                data-rental-price="{{ product.rental_price }}"
                                                data-deposit="{{ product.deposit_amount }}"
                                                data-type="{{ product.get_rental_type_display }}"
                                                data-size="{{ product.size }}"
                                                {% if form.instance.formalwear_product and form.instance.formalwear_product.id == product.id %}selected{% endif %}>
                                            {{ product.name }} - ${{ product.rental_price }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td class="rental-type" data-field="rental_type">
                                    {% if form.instance.formalwear_product %}
                                        {{ form.instance.formalwear_product.get_rental_type_display }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td class="size">
                                    {% if form.instance.formalwear_product %}
                                        {{ form.instance.formalwear_product.size }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    <input type="number" class="form-control text-center"
                                           name="{{ form.quantity.html_name }}"
                                           id="{{ form.quantity.id_for_label }}"
                                           value="{{ form.quantity.value|default_if_none:1 }}"
                                           style="max-width: 70px;">
                                </td>
                                <td class="rental-price">
                                    {% if form.instance.formalwear_product %}
                                        ${{ form.instance.formalwear_product.rental_price|multiply:form.quantity.value|floatformat:2 }}
                                    {% else %}
                                        $0.00
                                    {% endif %}
                                </td>
                                <td class="deposit-amount">
                                    {% if form.instance.formalwear_product %}
                                        ${{ form.instance.formalwear_product.deposit_amount|floatformat:2 }}
                                    {% else %}
                                        $0.00
                                    {% endif %}
                                </td>
                                <td>
                                    <input type="date" class="form-control"
                                           name="{{ form.rental_return_date.html_name }}"
                                           id="{{ form.rental_return_date.id_for_label }}"
                                           value="{{ form.rental_return_date.value|default_if_none:'' }}"
                                           style="max-width: 150px;">
                                </td>
                                <td>
                                    {% if form.instance.created_at %}
                                        {{ form.instance.created_at|date:"Y-m-d H:i" }}
                                    {% else %}
                                        Not yet added
                                    {% endif %}
                                </td>
                                <td>
                                    {{ form.DELETE }}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-dusty-pink" id="add-formalwear-btn">
                        Add Another Formalwear Item
                    </button>
                    <button type="button" class="btn btn-dusty-pink" id="save-formalwear-btn">
                        Update Formalwear
                    </button>
                <div class="text-right total-product-cost-container">
                    <p>
                        <strong>Total Formalwear Cost:</strong>
                        <span id="total-formalwear-product-cost">
                            ${{ contract.calculate_formalwear_subtotal|floatformat:2 }}
                        </span>
                    </p>
                </div>
                </form>
            </div>
        </div>
    </div>
</div>
