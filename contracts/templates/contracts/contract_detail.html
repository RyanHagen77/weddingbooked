{% extends "base.html" %}
{% load static %}

{% block head %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <meta charset="UTF-8">
    <title>Contract Detail</title>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- Include your custom CSS file -->
    <link rel="stylesheet" href="{% static 'contracts/styles.css' %}">
    <script src="{% static 'contracts/js/booking_notes.js' %}"></script>
{% endblock head %}

{% block content %}
<body data-contract-id="{{ contract.contract_id }}" data-payment-schedule-id="{{ contract.payment_schedule.id }}">

    <!-- Main Header Section -->
    <header class="bg-cool-grey text-white py-1">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center" id="header-event-date">
                    <p class="mb-0 small-text">Event Date: {{ contract.event_date|date:"Y-m-d" }}</p>
                </div>
                <div class="d-flex align-items-center">
                    <a href="{% url 'contracts:generate_contract_pdf' contract_id=contract.contract_id %}" class="section-link small-text" target="_blank">Print Contract</a>
                    <span class="mx-2 section-divider">|</span>
                    <a href="{% url 'contracts:contract_agreement' contract_id=contract.contract_id %}" class="section-link small-text" target="_blank">View Contract</a>
                    <span class="mx-2 section-divider">|</span>
                    <a href="{% url 'communication:send_portal_access' contract_id=contract.contract_id %}" class="section-link small-text" id="give-portal-access-btn">Give Portal Access</a>
                </div>
                <div class="d-flex align-items-center">
                    <p class="mb-0 small-text">Contract ID: {{ contract.custom_contract_number }}</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Section -->
    <main class="container mt-3">
        <div class="card-container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <div class="card bg-white">
                        <div class="card-body">
                            <p class="card-text" id="header-status">Status: {{ contract.get_status_display }}</p>
                            <p class="card-text" id="header-location">Location: {{ contract.location.name }}</p>
                            <p class="card-text" id="header-csr">Sales Person: {{ contract.csr.get_full_name }}</p>
                            <p class="card-text">Contract Date: {{ contract.contract_date|date:"Y-m-d" }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card bg-white">
                        <div class="card-body">
                            <p class="card-text" id="header-primary-contact">Primary Contact: {{ contract.client.primary_contact }}</p>
                            <p class="card-text" id="header-partner-contact">Partner Contact: {{ contract.client.partner_contact }}</p>
                            <p class="card-text" id="header-primary-email">Primary Email: {{ contract.client.primary_email }}</p>
                            <p class="card-text" id="header-primary-phone">Primary Phone 1: {{ contract.client.primary_phone1 }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card bg-white">
                        <div class="card-body">
                            <p id="payment-amount-due" class="card-text">Next Payment Due: $0.00</p>
                            <p id="due-date" class="card-text">Due Date: N/A</p>
                            <p class="card-text">Balance Due: ${{ contract.balance_due }}</p>
                            <p class="card-text">Contract Total: ${{ contract.final_total }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

   <!-- Bootstrap and other libraries should load after jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Custom JavaScript can be included here or in extra_head, depending on dependencies -->
    <script src="{% static 'communication/js/tasks.js' %}"></script>
</body>


    <div class="container mt-3">
        <!-- Hidden Field for Total Cost -->
        <input type="hidden" id="total_cost" name="total_cost" value="">
        <input type="hidden" id="total_service_cost" name="total_service_cost" value="">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs" id="mainTabs">
            <li class="nav-item"><a class="nav-link active text-dark-sienna" href="#info" data-toggle="tab">Info</a></li>
            <li class="nav-item"><a class="nav-link text-dark-sienna" href="#client" data-toggle="tab">Client</a></li>
            <li class="nav-item"><a class="nav-link text-dark-sienna" href="#event" data-toggle="tab">Event</a></li>
            <li class="nav-item"><a class="nav-link text-dark-sienna" href="#services" data-toggle="tab">Services</a></li>
            <li class="nav-item"><a class="nav-link text-dark-sienna" href="#products" data-toggle="tab">Products</a></li>
            <li class="nav-item"><a class="nav-link text-dark-sienna" href="#docs" data-toggle="tab">Docs</a></li>
            <li class="nav-item"><a class="nav-link text-dark-sienna" href="#financial" data-toggle="tab">Financial</a></li>
            <li class="nav-item"><a class="nav-link text-dark-sienna" href="#communication" data-toggle="tab">Communication</a></li>
            <li class="nav-item"><a class="nav-link text-dark-sienna" href="#changelog" data-toggle="tab">Change Log</a></li>
        </ul>

<!-- Tab content -->
        <div class="content-below-nav">
            <div class="tab-content field-box">
                <div class="tab-pane container fade show active" id="info">
                    <!-- Static Contract Info -->
                    <div id="contract-info" class="row">
                        <!-- Static details -->
                    <div class="col-md-6">
                        <p id="contract-location" data-location-id="{{ contract.location.id }}">Location: {{ contract.location.name }}</p>
                        <p id="contract-event-date">Event Date: {{ contract.event_date }}</p>
                        <p id="contract-status">Status: {{ contract.get_status_display }}</p>
                        <p id="contract-csr">Sales Person: {{ contract.csr.get_full_name }}</p>
                        <p id="contract-coordinator">Coordinator: {{ contract.coordinator.get_full_name }}</p>
                    </div>
                     <div class="col-md-6">
                        <p id="contract-lead-source">Lead Source: {{ contract.get_lead_source_display }}</p>
                        <p id="contract-code-92-status">Code 92: {{ contract.is_code_92|yesno:"Yes,No" }}</p>
                        <p id="contract-old-number">Old Contract Number: {{ contract.old_contract_number }}</p>
                    </div>
                        <!-- Edit Button -->
                        <button id="edit-contract-info-button" class="btn-dusty-pink" onclick="toggleEditForm(true)">Edit Contract Info</button>
                        <!-- Add Special Terms Button -->
                        <button type="button" class="btn-dusty-pink" data-toggle="modal" data-target="#customTextModal">
                            Add/Edit Special Terms
                        </button>
                    </div>
                    <div id="edit-contract-info" class="col-md-6" style="display:none;">
                        <form id="edit-contract-info-form" method="post" action="{% url 'contracts:edit_contract' id=contract.contract_id %}" enctype="multipart/form-data">
                            {% csrf_token %}
                            {{ contract_info_edit_form.as_p }}
                            <button type="submit">Save Changes</button>
                            <button type="button" class="btn-close" onclick="toggleEditForm(false)">Close</button>
                        </form>
                    </div>
                </div>
                <div class="tab-pane container fade" id="client">
                    <div class="row">
                        <!-- Left Column for Editable Client Fields -->
                        <div class="col-md-6">
                            <form id="edit-client-form" method="post" action="{% url 'contracts:edit_contract' id=contract.contract_id %}">
                                {% csrf_token %}
                                <div class="row">
                                    <!-- Column 1 -->
                                    <div class="col-md-6">
                                        <label for="{{ client_edit_form.primary_contact.id_for_label }}">Primary Contact:</label>
                                        {{ client_edit_form.primary_contact }}
                                        <label for="{{ client_edit_form.primary_email.id_for_label }}">Primary Email:</label>
                                        {{ client_edit_form.primary_email }}
                                        <label for="{{ client_edit_form.primary_phone1.id_for_label }}">Primary Phone 1:</label>
                                        {{ client_edit_form.primary_phone1 }}
                                        <!-- ... more fields for the first column ... -->
                                    </div>

                                    <!-- Column 2 -->
                                    <div class="col-md-6">
                                        <label for="{{ client_edit_form.partner_contact.id_for_label }}">Partner Contact:</label>
                                        {{ client_edit_form.partner_contact }}
                                        <label for="{{ client_edit_form.partner_email.id_for_label }}">Partner Email:</label>
                                        {{ client_edit_form.partner_email }}
                                        <label for="{{ client_edit_form.partner_phone1.id_for_label }}">Partner Phone 1:</label>
                                        {{ client_edit_form.partner_phone1}}
                                        <!-- ... more fields for the second column ... -->
                                    </div>
                                </div>

                                <!-- Button to Show/Hide Additional Client Fields -->
                                <button type="button" id="toggleClientInfo" class="btn btn-dusty-pink">Show More Client Info</button>
                                <!-- Additional Client Fields (Initially Hidden) -->
                                <div id="additionalClientInfo" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="{{ client_edit_form.primary_address1.id_for_label }}">Primary Address 1:</label>
                                            {{ client_edit_form.primary_address1 }}
                                            <label for="{{ client_edit_form.primary_address2.id_for_label }}">Primary Address 2:</label>
                                            {{ client_edit_form.primary_address2 }}
                                            <label for="{{ client_edit_form.city.id_for_label }}">City:</label>
                                            {{ client_edit_form.city }}
                                            <label for="{{ client_edit_form.state.id_for_label }}">State:</label>
                                            {{ client_edit_form.state }}
                                            <label for="{{ client_edit_form.postal_code.id_for_label }}">Postal Code:</label>
                                            {{ client_edit_form.postal_code }}
                                            <!-- ... additional fields for the first column ... -->
                                        </div>
                                        <div class="col-md-6">
                                            <label for="{{ client_edit_form.alt_contact.id_for_label }}">Alternative Contact:</label>
                                            {{ client_edit_form.alt_contact }}
                                            <label for="{{ client_edit_form.alt_email.id_for_label }}">Alternative Email:</label>
                                            {{ client_edit_form.alt_email }}
                                            <label for="{{ client_edit_form.alt_phone.id_for_label }}">Alternative Phone:</label>
                                            {{ client_edit_form.alt_phone }}
                                            <!-- ... additional fields for the second column ... -->
                                        </div>
                                    </div>
                                </div>
                                <!-- Form Submit Button -->
                                <button type="submit" class="btn btn-dusty-pink">Save Changes</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="tab-pane container fade" id="event">
                    <div class="row">
                        <!-- Editable Event Details Form -->
                        <div class="col-md-6">
                            <form id="edit-event-form" method="post" action="{% url 'contracts:edit_contract' id=contract.contract_id %}">
                                {% csrf_token %}
                                <div class="row">
                                    <!-- Column 1 -->
                                    <div class="col-md-6">
                                        <label for="{{ event_edit_form.bridal_party_qty.id_for_label }}">Bridal Party Quantity:</label>
                                        {{ event_edit_form.bridal_party_qty }}
                                        <label for="{{ event_edit_form.ceremony_site.id_for_label }}">Ceremony Site:</label>
                                        {{ event_edit_form.ceremony_site }}
                                        <label for="{{ event_edit_form.ceremony_city.id_for_label }}">Ceremony City:</label>
                                        {{ event_edit_form.ceremony_city }}
                                        <label for="{{ event_edit_form.ceremony_state.id_for_label }}">Ceremony State:</label>
                                        {{ event_edit_form.ceremony_state }}
                                        <!-- ... other fields for the first column ... -->
                                    </div>

                                    <!-- Column 2 -->
                                    <div class="col-md-6">
                                        <label for="{{ event_edit_form.guests_qty.id_for_label }}">Guests Quantity:</label>
                                        {{ event_edit_form.guests_qty }}
                                        <label for="{{ event_edit_form.reception_site.id_for_label }}">Reception Site:</label>
                                        {{ event_edit_form.reception_site }}
                                        <label for="{{ event_edit_form.reception_city.id_for_label }}">Reception City:</label>
                                        {{ event_edit_form.reception_city }}
                                        <label for="{{ event_edit_form.reception_state.id_for_label }}">Reception State:</label>
                                        {{ event_edit_form.reception_state }}
                                        <!-- ... other fields for the second column ... -->
                                    </div>
                                </div>

                                <!-- Toggle Button for Additional Event Fields -->
                                <button type="button" id="toggleEventDetails" class="btn-dusty-pink mt-3 mb-3">Show More Event Details</button>

                                <!-- Additional Event Fields (Initially Hidden) -->
                                <div id="additionalEventDetails" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <!-- Ceremony Contact -->
                                            <label for="{{ event_edit_form.ceremony_contact.id_for_label }}">Ceremony Contact:</label>
                                            {{ event_edit_form.ceremony_contact }}

                                            <!-- Ceremony Phone -->
                                            <label for="{{ event_edit_form.ceremony_phone.id_for_label }}">Ceremony Phone:</label>
                                            {{ event_edit_form.ceremony_phone }}

                                            <!-- Ceremony Email -->
                                            <label for="{{ event_edit_form.ceremony_email.id_for_label }}">Ceremony Email:</label>
                                            {{ event_edit_form.ceremony_email }}
                                        </div>

                                        <div class="col-md-6">
                                            <!-- Reception Contact -->
                                            <label for="{{ event_edit_form.reception_contact.id_for_label }}">Reception Contact:</label>
                                            {{ event_edit_form.reception_contact }}

                                            <!-- Reception Phone -->
                                            <label for="{{ event_edit_form.reception_phone.id_for_label }}">Reception Phone:</label>
                                            {{ event_edit_form.reception_phone }}

                                            <!-- Reception Email -->
                                            <label for="{{ event_edit_form.reception_email.id_for_label }}">Reception Email:</label>
                                            {{ event_edit_form.reception_email }}
                                        </div>
                                    </div>
                                </div>

                                <!-- Form Submit Button -->
                                <button type="submit" class="btn-dusty-pink mt-3 mb-3">Save Changes</button>

                            </form>
                        </div>
                    </div>
                </div>

                <!-- Services Tab -->
                <div class="tab-pane container fade" id="services" style="padding-bottom: 30px;">
                    <!-- Tab Navigation for Services -->
                    <ul class="nav nav-tabs" id="serviceTabs">
                        <li class="nav-item"><a class="nav-link active text-dark-sienna" href="#photography" data-toggle="tab">Photography</a></li>
                        <li class="nav-item"><a class="nav-link text-dark-sienna" href="#videography" data-toggle="tab">Videography</a></li>
                        <li class="nav-item"><a class="nav-link text-dark-sienna" href="#dj" data-toggle="tab">DJ</a></li>
                        <li class="nav-item"><a class="nav-link text-dark-sienna" href="#photobooth" data-toggle="tab">Photobooth</a></li>
                        <li class="nav-item"><a class="nav-link text-dark-sienna" href="#discounts" data-toggle="tab">Discounts</a></li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- Photography Tab Content -->
                        <div class="tab-pane active" id="photography">
                            <form method="post" action="{% url 'contracts:edit_services' id=contract.contract_id %}">
                                {% csrf_token %}
                                                            <!-- Hidden Fields -->
                                <input type="hidden" id="contractId" value="{{ contract.contract_id }}">
                                <input type="hidden" id="id_event_date" value="{{ contract.event_date|date:'Y-m-d' }}">
                                <input type="hidden" id="discount" value="{{ initial_discount_value }}">
                                <input type="hidden" id="overtimeServiceType" value="">
                                <input type="hidden" name="section" value="{{ current_tab }}">
                                <input type="hidden" id="hiddenSavedPhotographyPackageId" value="{{ contract.photography_package_id }}">
                                <input type="hidden" id="hiddenSavedPhotographyAdditionalStaffId" value="{{ contract.photography_additional_id }}">
                                <input type="hidden" id="hiddenSavedEngagementSessionId" value="{{ contract.engagement_session_id }}">

                                <!-- Photography Services Section -->
                                <div class="service-category">
                                    <h3></h3>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Hours</th>
                                                <th>Price</th>
                                                <th>Staff</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Photography Package -->
                                            <tr>
                                                <td>
                                                    <select id="id_photography_package" name="photography_package">
                                                        <option value="">Select a Photography Package</option>
                                                        {% for package in photography_packages %}
                                                            <option value="{{ package.id }}"
                                                                    data-price="{{ package.price|floatformat:2 }}"
                                                                    data-hours="{{ package.hours }}"
                                                                    {% if contract.photography_package.id == package.id %}selected="selected"{% endif %}>
                                                                {{ package.name }} - ${{ package.price|floatformat:2 }} - {{ package.hours }} hours
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                <td id="photography-package-hours"></td>
                                                <td id="photography-package-price"><!-- Dynamically populated price --></td>
                                                <td id="assigned-photographer1"><!-- Dynamically populated assigned staff --></td>
                                                <td>
                                                    <button type="button" class="btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="PHOTOGRAPHER1" data-service-type="Photography">Assign</button>
                                                    <button type="button" class="btn-dusty-pink edit-button" data-toggle="modal" data-target="#bookingModal" data-role="PHOTOGRAPHER1" data-service-type="Photography" data-booking-id="1">Edit</button>
                                                </td>
                                            </tr>
                                            <!-- Additional Photographer -->
                                            <tr>
                                                <td>
                                                    <select id="id_photography_additional" name="photography_additional">
                                                        <option value="">Select Additional Photographer</option>
                                                        {% for option in additional_photography_options %}
                                                            <option value="{{ option.id }}" data-price="{{ option.price|floatformat:2 }}"
                                                                {% if contract.photography_additional and contract.photography_additional.id == option.id %}selected="selected"{% endif %}>
                                                                {{ option.name }} - ${{ option.price|floatformat:2 }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                <td id="additional-photography-hours"></td>
                                                <td id="additional-photography-price"><!-- Dynamically populated price --></td>
                                                <td id="assigned-photographer2"><!-- Dynamically populated assigned staff --></td>
                                                <td>
                                                    <button type="button" class="btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="PHOTOGRAPHER2" data-service-type="Photography">Assign</button>
                                                    <button type="button" class="btn-dusty-pink edit-button" data-toggle="modal" data-target="#bookingModal" data-role="PHOTOGRAPHER2" data-service-type="Photography" data-booking-id="1">Edit</button>
                                                </td>
                                            </tr>
                                            <!-- Engagement Session -->
                                            <tr>
                                                <td>
                                                    <select id="id_engagement_session" name="engagement_session">
                                                        <option value="">Select an Engagement Session</option>
                                                        {% for session in engagement_session_options %}
                                                            <option value="{{ session.id }}" data-price="{{ session.price|floatformat:2 }}"
                                                                {% if contract.engagement_session and contract.engagement_session.id == session.id %}selected="selected"{% endif %}>
                                                                {{ session.name }} - ${{ session.price|floatformat:2 }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                <td id="engagement-session-hours"></td>
                                                <td id="engagement-session-price"><!-- Dynamically populated price --></td>
                                                <td id="engagement-session-staff"><!-- Dynamically populated staff --></td>
                                                <td>
                                                    <button type="button" class="btn btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="ENGAGEMENT" data-service-type="Photography">Assign</button>
                                                    <button type="button" class="btn-dusty-pink edit-button" data-toggle="modal" data-target="#bookingModal" data-role="ENGAGEMENT" data-service-type="Photography" data-booking-id="1">Edit</button>
                                                </td>
                                            </tr>
                                            <!-- Prospect Photographers -->
                                            <tr>
                                                <td colspan="5"><strong>Prospect Photographers</strong></td>
                                            </tr>
                                            <tr>
                                                <td>Prospect Photographer 1</td>
                                                <td colspan="3">{{ contract.prospect_photographer1.get_full_name|default:"None" }}</td>
                                                <td>
                                                    <!-- Trigger Modal for booking/change -->
                                                    <button type="button" class="btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="PROSPECT1" data-service-type="Photography" data-staff-id="{{ contract.prospect_photographer1.id }}">
                                                        Assign
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Prospect Photographer 2</td>
                                                <td colspan="3">{{ contract.prospect_photographer2.get_full_name|default:"None" }}</td>
                                                <td>
                                                    <!-- Trigger Modal for booking/change -->
                                                    <button type="button" class="btn btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="PROSPECT2" data-service-type="Photography" data-staff-id="{{ contract.prospect_photographer2.id }}">
                                                        Assign
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Prospect Photographer 3</td>
                                                <td colspan="3">{{ contract.prospect_photographer3.get_full_name|default:"None" }}</td>
                                                <td>
                                                    <!-- Trigger Modal for booking/change -->
                                                    <button type="button" class="btn btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="PROSPECT3" data-service-type="Photography" data-staff-id="{{ contract.prospect_photographer3.id }}">
                                                        Assign
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            <!-- Overtime Details Section -->
                            <div>
                                <h6><strong>Overtime Details</strong></h6>
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Service</th>
                                            <th>Hours</th>
                                            <th>Cost</th>
                                            <th>Staff</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="photographyOvertimeEntriesDisplay" class="overtime-entries-display">
                                        <!-- Dynamically added overtime entries will be inserted here -->
                                        <!-- Example entry -->
                                        <tr>
                                            <td>Photography</td>
                                            <td>2 hours</td>
                                            <td>$200</td>
                                            <td>John Doe</td>
                                            <td>
                                                <button type="button" class="btn btn-dusty-pink edit-overtime-button" data-id="1" data-service="Photography">Edit</button>
                                                <button type="button" class="btn btn-dusty-pink remove-overtime-button" data-id="1" data-service="Photography">Remove</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                    <button id="addPhotographyOvertimeEntryButton" type="button" class="btn btn-dusty-pink">Add Overtime Entry</button>
                                <div id="photographyOvertimeEntryForm" style="display:none;">
                                    <input type="hidden" id="photographyOvertimeEntryId" value="">
                                    <select id="photographyOvertimeOptionSelect"></select>
                                    <input type="number" id="photographyOvertimeHours" placeholder="Hours">
                                <button type="button" id="savePhotographyOvertimeEntryButton" class="btn btn-dusty-pink">Save Overtime Entry</button>
                                </div>
                            </div>
                            <!-- Total Overtime and Photography Cost -->
                            <div class="text-right total-cost-container">
                                <p><strong>Total Overtime Cost:</strong> <span id="total-photography-overtime-cost"></span></p>
                                <p><strong>Total Photography Cost:</strong> <span id="total-photography-cost"></span></p>
                            </div>
                                <button type="button" id="savePhotographySection" class="btn btn-dusty-pink float-right">Save Changes</button>
                            </form>
                        </div>
                        <!-- Videography Tab Content -->
                        <div class="tab-pane" id="videography">
                            <form method="post" action="{% url 'contracts:edit_services' id=contract.contract_id %}">
                                {% csrf_token %}
                                <!-- Hidden Fields -->
                                <input type="hidden" name="section" value="videography">
                                <input type="hidden" id="hiddenSavedVideographyPackageId" value="{{ contract.videography_package_id }}">
                                <input type="hidden" id="hiddenSavedVideographyAdditionalStaffId" value="{{ contract.videography_additional_id }}">

                                <!-- Videography Services Section -->
                                <div class="service-category">
                                    <h3></h3>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Hours</th>
                                                <th>Price</th>
                                                <th>Assigned Staff</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Videography Package -->
                                            <tr>
                                                <td>
                                                    <select id="id_videography_package" name="videography_package">
                                                        <option value="">Select a Videography Package</option>
                                                        {% for package in videography_packages %}
                                                            <option value="{{ package.id }}"
                                                                    data-price="{{ package.price|floatformat:2 }}"
                                                                    data-hours="{{ package.hours }}"
                                                                    {% if contract.videography_package.id == package.id %}selected="selected"{% endif %}>
                                                                {{ package.name }} - ${{ package.price|floatformat:2 }} - {{ package.hours }} hours
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                <td id="videography-package-hours"></td>
                                                <td id="videography-package-price"><!-- Dynamically populated price --></td>
                                                <td id="assigned-videographer1"><!-- Dynamically populated assigned staff --></td>
                                                <td>
                                                    <button type="button" class="btn btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="VIDEOGRAPHER1" data-service-type="Videography">Assign</button>
                                                    <button type="button" class="btn-dusty-pink edit-button" data-toggle="modal" data-target="#bookingModal" data-role="VIDEOGRAPHER1" data-service-type="Videography" data-booking-id="1">Edit</button>

                                                </td>
                                            </tr>
                                            <!-- Additional Videographer -->
                                            <tr>
                                                <td>
                                                    <select id="id_videography_additional" name="videography_additional">
                                                        <option value="">Select Additional Videographer</option>
                                                        {% for option in additional_videography_options %}
                                                            <option value="{{ option.id }}" data-price="{{ option.price|floatformat:2 }}"
                                                                {% if contract.videography_additional and contract.videography_additional.id == option.id %}selected="selected"{% endif %}>
                                                                {{ option.name }} - ${{ option.price|floatformat:2 }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                <td id="additional-videography-hours"></td>
                                                <td id="additional-videography-price"><!-- Dynamically populated price --></td>
                                                <td id="assigned-videographer2"><!-- Dynamically populated assigned staff --></td>
                                                <td>
                                                    <button type="button" class="btn btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="VIDEOGRAPHER2" data-service-type="Videography">Assign</button>
                                                    <button type="button" class="btn-dusty-pink edit-button" data-toggle="modal" data-target="#bookingModal" data-role="VIDEOGRAPHER2" data-service-type="Videography" data-booking-id="1">Edit</button>

                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Overtime Details Section for Videography -->
                                <div>
                                    <h6><strong>Overtime Details</strong></h6>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Hours</th>
                                                <th>Cost</th>
                                                <th>Assigned Staff</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="videographyOvertimeEntriesDisplay" class="overtime-entries-display">
                                            <!-- Dynamically added overtime entries for videography will be inserted here -->
                                            <!-- Example entry -->
                                            <tr>
                                                <td>Videography</td>
                                                <td>3 hours</td>
                                                <td>$300</td>
                                                <td>Jane Smith</td>
                                                <td>
                                                    <button type="button" class="btn btn-dusty-pink edit-overtime-button" data-id="2" data-service="Videography">Edit</button>
                                                    <button type="button" class="btn btn-dusty-pink remove-overtime-button" data-id="2" data-service="Videography">Remove</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button id="addVideographyOvertimeEntryButton" type="button" class="btn btn-dusty-pink">Add Overtime Entry</button>
                                    <!-- Overtime Entry Form for Videography (hidden by default) -->
                                    <div id="videographyOvertimeEntryForm" style="display:none;">
                                        <input type="hidden" id="videographyOvertimeEntryId" value="">
                                        <select id="videographyOvertimeOptionSelect"></select>
                                        <input type="number" id="videographyOvertimeHours" placeholder="Hours">
                                        <button type="button" id="saveVideographyOvertimeEntryButton" class="btn btn-dusty-pink">Save Overtime Entry</button>
                                    </div>
                                </div>
                                <!-- Total Overtime and Videography Cost -->
                                <div class="text-right total-cost-container">
                                    <p><strong>Total Videography Overtime Cost:</strong> <span id="total-videography-overtime-cost"></span></p>
                                    <p><strong>Total Videography Cost:</strong> <span id="total-videography-cost"></span></p>
                                </div>
                                <button type="button" id="saveVideographySection" class="btn btn-dusty-pink float-right">Save Changes</button>
                            </form>
                        </div>
                        <!-- DJ Tab Content -->
                        <div class="tab-pane" id="dj">
                            <form method="post" action="{% url 'contracts:edit_services' id=contract.contract_id %}">
                                {% csrf_token %}
                                <!-- Hidden Fields -->
                                <input type="hidden" name="section" value="dj">
                                <input type="hidden" id="hiddenSavedDjPackageId" value="{{ contract.dj_package_id }}">
                                <input type="hidden" id="hiddenSavedDjAdditionalStaffId" value="{{ contract.dj_additional_id }}">

                                <!-- DJ Services Section -->
                                <div class="service-category">
                                    <h3></h3>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Hours</th>
                                                <th>Price</th>
                                                <th>Assigned Staff</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- DJ Package -->
                                            <tr>
                                                <td>
                                                    <select id="id_dj_package" name="dj_package">
                                                        <option value="">Select a DJ Package</option>
                                                        {% for package in dj_packages %}
                                                            <option value="{{ package.id }}"
                                                                    data-price="{{ package.price|floatformat:2 }}"
                                                                    data-hours="{{ package.hours }}"
                                                                    {% if contract.dj_package.id == package.id %}selected="selected"{% endif %}>
                                                                {{ package.name }} - ${{ package.price|floatformat:2 }} - {{ package.hours }} hours
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                <td id="dj-package-hours"></td>
                                                <td id="dj-package-price"><!-- Dynamically populated price --></td>
                                                <td id="assigned-dj1"><!-- Dynamically populated assigned staff --></td>
                                                <td>
                                                <button type="button" class="btn btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="DJ1" data-service-type="Dj">Assign</button>
                                                <button type="button" class="btn-dusty-pink edit-button" data-toggle="modal" data-target="#bookingModal" data-role="DJ1" data-service-type="Dj" data-booking-id="1">Edit</button>

                                                </td>
                                            </tr>
                                            <!-- Additional DJ -->
                                            <tr>
                                                <td>
                                                    <select id="id_dj_additional" name="dj_additional">
                                                        <option value="">Select Additional DJ</option>
                                                        {% for option in additional_dj_options %}
                                                            <option value="{{ option.id }}" data-price="{{ option.price|floatformat:2 }}"
                                                                {% if contract.dj_additional and contract.dj_additional.id == option.id %}selected="selected"{% endif %}>
                                                                {{ option.name }} - ${{ option.price|floatformat:2 }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                <td id="additional-dj-hours"></td>
                                                <td id="additional-dj-price"><!-- Dynamically populated price --></td>
                                                <td id="assigned-dj2"><!-- Dynamically populated assigned staff --></td>
                                                <td>
                                                <button type="button" class="btn btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="DJ2" data-service-type="Dj">Assign</button>
                                                <button type="button" class="btn-dusty-pink edit-button" data-toggle="modal" data-target="#bookingModal" data-role="DJ2" data-service-type="Dj" data-booking-id="1">Edit</button>

                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Overtime Details Section for DJ -->
                                <div>
                                    <h6><strong>Overtime Details</strong></h6>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Hours</th>
                                                <th>Cost</th>
                                                <th>Assigned Staff</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="djOvertimeEntriesDisplay" class="overtime-entries-display">
                                            <!-- Dynamically added overtime entries for DJ will be inserted here -->
                                            <!-- Example entry -->
                                            <tr>
                                                <td>DJ</td>
                                                <td>2 hours</td>
                                                <td>$150</td>
                                                <td>Jane Doe</td>
                                                <td>
                                                    <button type="button" class="btn btn-dusty-pink edit-overtime-button" data-id="3" data-service="DJ">Edit</button>
                                                    <button type="button" class="btn btn-dusty-pink remove-overtime-button" data-id="3" data-service="DJ">Remove</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button id="addDjOvertimeEntryButton" type="button" class="btn btn-dusty-pink">Add Overtime Entry</button>
                                    <!-- Overtime Entry Form for DJ (hidden by default) -->
                                    <div id="djOvertimeEntryForm" style="display:none;">
                                        <input type="hidden" id="djOvertimeEntryId" value="">
                                        <select id="djOvertimeOptionSelect"></select>
                                        <input type="number" id="djOvertimeHours" placeholder="Hours">
                                        <button type="button" id="saveDjOvertimeEntryButton" class="btn btn-dusty-pink">Save Overtime Entry</button>
                                    </div>
                                </div>
                                <!-- Total Overtime and DJ Cost -->
                                <div class="text-right total-cost-container">
                                    <p><strong>Total DJ Overtime Cost:</strong> <span id="total-dj-overtime-cost"></span></p>
                                    <p><strong>Total DJ Cost:</strong> <span id="total-dj-cost"></span></p>
                                </div>
                                <button type="button" id="saveDjSection" class="btn btn-dusty-pink float-right">Save Changes</button>
                            </form>
                        </div>
                        <!-- Photobooth Tab Content -->
                        <div class="tab-pane" id="photobooth">
                            <form method="post" action="{% url 'contracts:edit_services' id=contract.contract_id %}">
                                {% csrf_token %}
                                <!-- Hidden Fields -->
                                <input type="hidden" name="section" value="photobooth">
                                <input type="hidden" id="hiddenSavedPhotoboothPackageId" value="{{ contract.photobooth_package_id }}">
                                <input type="hidden" id="hiddenSavedPhotoboothAdditionalStaffId" value="{{ contract.photobooth_additional_id }}">


                                <!-- Photobooth Services Section -->
                                <div class="service-category">
                                    <h3></h3>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Hours</th>
                                                <th>Price</th>
                                                <th>Assigned Staff</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                           <!-- Photobooth Service -->
                                            <tr>
                                                <td>
                                                    <select id="id_photobooth_package" name="photobooth_package">
                                                        <option value="">Select a Photobooth Service</option>
                                                        {% for package in photobooth_package %}
                                                            <option value="{{ package.id }}"
                                                                    data-price="{{ package.price|floatformat:2 }}"
                                                                    data-hours="{{ package.hours }}"
                                                                    {% if contract.photobooth_package.id == package.id %}selected="selected"{% endif %}>
                                                                {{ package.name }} - ${{ package.price|floatformat:2 }} - {{ package.hours }} hours
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                <td id="photobooth-package-hours"></td>
                                                <td id="photobooth-package-price"><!-- Dynamically populated price --></td>
                                                <td id="assigned-photobooth_op1"></td>
                                                <td>
                                                <button type="button" class="btn btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="PHOTOBOOTH_OP1" data-service-type="Photobooth">Assign</button>
                                                <button type="button" class="btn-dusty-pink edit-button" data-toggle="modal" data-target="#bookingModal" data-role="PHOTOBOOTH_OP1" data-service-type="Photobooth" data-booking-id="1">Edit</button>

                                                </td>
                                            </tr>

                                            <!-- Additional Photobooth -->
                                            <tr>
                                                <td>
                                                    <select id="id_photobooth_additional" name="photobooth_additional">
                                                        <option value="">Select Additional Photobooth</option>
                                                        {% for option in additional_photobooth_options %}
                                                            <option value="{{ option.id }}" data-price="{{ option.price|floatformat:2 }}"
                                                                {% if contract.photobooth_additional and contract.photobooth_additional.id == option.id %}selected="selected"{% endif %}>
                                                                {{ option.name }} - ${{ option.price|floatformat:2 }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </td>
                                                <td id="additional-photobooth-hours"></td>
                                                <td id="additional-photobooth-price"><!-- Dynamically populated price --></td>
                                                <td id="assigned-photobooth_op2"><!-- Dynamically populated assigned staff --></td>
                                                <td>
                                                <button type="button" class="btn btn-dusty-pink book-button" data-toggle="modal" data-target="#bookingModal" data-role="PHOTOBOOTH_OP2" data-service-type="Photobooth">Assign</button>
                                                <button type="button" class="btn-dusty-pink edit-button" data-toggle="modal" data-target="#bookingModal" data-role="PHOTOBOOTH_OP2" data-service-type="Photobooth" data-booking-id="1">Edit</button>

                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- Overtime Details Section for Photobooth -->
                                <div>
                                    <h6><strong>Overtime Details</strong></h6>
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Hours</th>
                                                <th>Cost</th>
                                                <th>Assigned Staff</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="photoboothOvertimeEntriesDisplay" class="overtime-entries-display">
                                            <!-- Dynamically added overtime entries for Photobooth will be inserted here -->
                                            <!-- Example entry -->
                                            <tr>
                                                <td>Photobooth</td>
                                                <td>1 hour</td>
                                                <td>$100</td>
                                                <td>Jane Doe</td>
                                                <td>
                                                    <button type="button" class="btn btn-dusty-pink edit-overtime-button" data-id="4" data-service="Photobooth">Edit</button>
                                                    <button type="button" class="btn btn-dusty-pink remove-overtime-button" data-id="4" data-service="Photobooth">Remove</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <button id="addPhotoboothOvertimeEntryButton" type="button" class="btn btn-dusty-pink">Add Overtime Entry</button>
                                    <!-- Overtime Entry Form for Photobooth (hidden by default) -->
                                    <div id="photoboothOvertimeEntryForm" style="display:none;">
                                        <input type="hidden" id="photoboothOvertimeEntryId" value="">
                                        <select id="photoboothOvertimeOptionSelect"></select>
                                        <input type="number" id="photoboothOvertimeHours" placeholder="Hours">
                                        <button type="button" id="savePhotoboothOvertimeEntryButton" class="btn btn-dusty-pink">Save Overtime Entry</button>
                                    </div>
                                </div>
                                <!-- Total Overtime and Photobooth Cost -->
                                <div class="text-right total-cost-container">
                                    <p><strong>Total Photobooth Overtime Cost:</strong> <span id="total-photobooth-overtime-cost"></span></p>
                                    <p><strong>Total Photobooth Cost:</strong> <span id="total-photobooth-cost"></span></p>
                                </div>
                                <button type="button" id="savePhotoboothSection" class="btn btn-dusty-pink float-right">Save Changes</button>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="discounts">
                            <!-- Form for entering discounts -->
                            <form method="post" action="{% url 'contracts:discounts_view' contract_id=contract.contract_id%}">
                                {% csrf_token %}
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label for="discountMemo">Discount Memo</label>
                                        <textarea class="form-control" id="discountMemo" name="memo" placeholder="Enter discount memo" style="max-height: 38px;"></textarea>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label for="discountAmount">Amount</label>
                                        <input type="number" class="form-control" id="discountAmount" name="amount" placeholder="Amount">
                                    </div>
                                    <div class="form-group col-md-5">
                                        <label for="discountServiceType">Service Type (Optional)</label>
                                        <select class="form-control" id="discountServiceType" name="service_type">
                                            <option value="">None</option>
                                            {% for service_type in service_types %}
                                                <option value="{{ service_type.id }}">{{ service_type.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group col-md-3 align-self-end">
                                        <button type="submit" class="btn btn-dusty-pink">Submit</button>
                                    </div>
                                </div>
                            </form>
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Memo</th>
                                        <th>Amount</th>
                                        <th>Service Type</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for discount in discounts %}
                                        <tr>
                                            <td>{{ discount.memo }}</td>
                                            <td>{{ discount.amount }}</td>
                                            <td>{{ discount.service_type }}</td>
                                            <td>
                                            <a href="{% url 'contracts:remove_discount' contract_id=contract.contract_id discount_id=discount.id %}" onclick="return confirm('Are you sure?');" class="btn-sm btn-danger">Delete</a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div><!-- Closes the tab-content div for all service tabs within the Services div -->
                </div> <!-- Closes the tab-pane container fade for the Services div -->
                <!-- Products Tab Content -->
                <div class="tab-pane fade" id="products">
                    <div class="row">
                        <div class="col-12">
                            <!-- Additional Products -->
                            <div id="products-section" class="mt-4">
                                <form method="post" action="{% url 'contracts:save_products' id=contract.contract_id %}">
                                    {% csrf_token %}
                                    {% load app_filters %}
                                    <input type="hidden" name="contract_id" value="{{ contract.contract_id }}">
                                    {{ products_formset.management_form }}
                                    <table id="products-table" class="table table-bordered table-hover">
                                        <thead class="table-bordered">
                                            <tr>
                                                <th class="product-column">Product</th>
                                                <th class="description-column">Description</th>
                                                <th class="quantity-column">Quantity</th>
                                                <th class="special-notes-column">Special Notes</th>
                                                <th class="unit-price-column">Unit Price</th>
                                                <th class="total-price-column">Total Price</th>
                                                <th class="remove-column">Remove</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for form in products_formset %}
                                            <tr>
                                                <td>{{ form.id }}{{ form.product }}</td>
                                                <td>{{ form.instance.get_product_description }}</td>
                                                <td>
                                                    <input type="number" class="form-control quantity-input" name="{{ form.quantity.html_name }}" id="{{ form.quantity.id_for_label }}" value="{{ form.quantity.value }}">
                                                </td>
                                                <td>
                                                    <textarea class="form-control special-notes-textarea" name="{{ form.special_notes.html_name }}" id="{{ form.special_notes.id_for_label }}">{{ form.special_notes.value }}</textarea>
                                                </td>
                                                <td class="unit-price">
                                                    ${{ form.instance.get_product_price|floatformat:2 }}
                                                </td>
                                                <td class="total-price">
                                                    ${{ form.instance.get_product_price|multiply:form.quantity.value|floatformat:2 }}
                                                </td>
                                                <td>
                                                    {{ form.DELETE }} <!-- Include the DELETE field -->
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                    <button type="button" class="btn btn-dusty-pink" onclick="addProduct()" id="add-product-btn">Add Another Product</button>
                                    <button type="submit" class="btn btn-dusty-pink">Update Products</button>
                                </form>
                                <!-- Total Overtime and Photobooth Cost -->
                                <div class="text-right total-product-cost-container">
                                    <p><strong>Tax Amount:</strong> <span id="tax_amount"></span></p>
                                    <p><strong>Total Products Cost:</strong> <span id="total-product-cost"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Documents Tab Content -->
                <div class="tab-pane fade" id="docs">
                    <div class="row">
                        <!-- Document List Section -->
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6>Documents</h6>
                                </div>
                                <div class="card-body">
                                    {% if documents %}
                                        <ul class="list-group">
                                            {% for document in documents %}
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    <a href="{{ document.document.url }}">{{ document.document.name }}</a>
                                                    <span class="badge {{ document.badge_class }}">{{ document.badge_label }}</span>
                                                    <!-- Form for deleting the document -->
                                                    <form action="{% url 'contracts:delete_document' document.id %}" method="post" style="display: inline;">
                                                        {% csrf_token %}
                                                        <button type="submit" class="btn btn-danger p-1 ml-2" style="font-size: 12px;">Delete</button>
                                                    </form>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p>No contract documents available.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Document Agreements Section -->
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6>Signed Digital Agreements</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Document Type</th>
                                                <th>Version</th>
                                                <th>Date Created</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Loop through contract agreements to display versions -->
                                            {% for agreement in contract.contract_agreements.all %}
                                            <tr>
                                                <td>Main Contractual Agreement</td>
                                                <td>{{ agreement.version_number }}</td>
                                                <td>{{ agreement.created_at|date:"Y-m-d" }}</td>
                                                <td>
                                                    <a href="{% url 'contracts:view_submitted_contract' contract.contract_id agreement.version_number %}">View Version {{ agreement.version_number }}</a>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                            <tr>
                                                <td>Rider Agreements</td>
                                                <td>-</td>
                                                <td>-</td>
                                                <td>
                                                    <a href="{% url 'contracts:view_rider_agreements' contract.contract_id %}">View Riders</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Document Upload Section -->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6>Upload Documents</h6>
                                </div>
                                <div class="card-body">
                                    <form method="post" action="" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        {{ document_form.as_p }}
                                        <button type="submit" name="upload_document" class="btn btn-dusty-pink">Upload Document</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Office Staff Link to Wedding Day Guide -->
                    {% if is_office_staff %}
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6>Wedding Day Guide</h6>
                                </div>
                                <div class="card-body">
                                    <a href="{% url 'contracts:wedding_day_guide' contract.contract_id %}" class="btn btn-dusty-pink">
                                        View/Edit Wedding Day Guide
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                <div class="tab-pane container fade" id="financial">
                    <input type="hidden" class="form-control" id="id_location" name="location">
                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active text-dark-sienna" id="payments-tab" data-toggle="tab" href="#payments" role="tab" aria-controls="payments" aria-selected="true">Payments</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark-sienna" id="sales-tab" data-toggle="tab" href="#sales" role="tab" aria-controls="sales" aria-selected="false">Sales</a>
                        </li>
                    </ul>
                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- Payments Tab -->
                        <div class="tab-pane fade show active" id="payments" role="tabpanel" aria-labelledby="payments-tab">
                            <!-- Payments Content -->
                            <div class="payments-content">
                                <!-- Payment Schedule Selection -->
                                <div class="payment-schedule-selection">
                                    <label for="payment-schedule">Payment Schedule:</label>
                                    <select id="payment-schedule" name="payment_schedule" onchange="handleScheduleChange(this.value)" disabled>
                                        <option value="schedule_a" {% if contract.payment_schedule and contract.payment_schedule.schedule_type == 'schedule_a' %}selected{% endif %}>Schedule A</option>
                                        <option value="custom" {% if contract.payment_schedule and contract.payment_schedule.schedule_type == 'custom' %}selected{% endif %}>Custom</option>
                                    </select>
                                    <button type="button" class="btn btn-dusty-pink" data-toggle="modal" data-target="#scheduleModal">
                                        Add or Update Schedule
                                    </button>
                                    <button type="button" id="receive-payment-button" class="btn btn-dusty-pink" onclick="receivePayment()">Receive Payment</button>
                                    <button type="button" class="btn btn-dusty-pink" data-toggle="modal" data-target="#serviceFeeModal">
                                        Add or Update Service Fees
                                    </button>
                                </div>
                                <!-- Payment Schedule Table -->
                                <div id="payment-schedule-table">
                                    <!-- Table for displaying Schedule A or custom schedule -->
                                </div>
                                <hr>
                                <!-- Existing Payments Table -->
                                <div class="text-right">
                                    <div class="contract-total" data-contract-total="{{ contract.calculate_total_cost }}">
                                        <strong>Total Contract Amount:</strong> ${{ contract.calculate_total_cost }}
                                    </div>
                                    <!-- Balance due element -->
                                    <div class="balance-due" data-initial-balance="{{ contract.balance_due }}">
                                        <strong>Balance Due:</strong> <span id="balance-due-amount">${{ contract.balance_due|floatformat:2 }}</span>
                                    </div>
                                </div>
                                <hr>
                                <!-- Existing Payments Section -->
                                <div class="d-flex justify-content-between align-items-center mt-4">
                                    <h6>Existing Payments:</h6>
                                </div>
                                <table class="table table-hover existing-payments-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Amount</th>
                                            <th>Method</th>
                                            <th>Purpose</th>
                                            <th>Reference</th>
                                            <th>Memo</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for payment in contract.payments.all %}
                                        <tr data-payment-id="{{ payment.id }}" data-payment-purpose="{{ payment.payment_purpose.name }}">
                                            <td>{{ payment.date }}</td>
                                            <td>${{ payment.amount }}</td>
                                            <td>{{ payment.get_payment_method_display }}</td>
                                            <td>{{ payment.payment_purpose.name }}</td>
                                            <td>{{ payment.payment_reference }}</td>
                                            <td>{{ payment.memo }}</td>
                                            <td>
                                                <button type="button" class="btn btn-info btn-sm" onclick="editPayment('{{ payment.id }}', '{{ payment.amount }}', '{{ payment.payment_method }}', '{{ payment.payment_reference }}', '{{ payment.memo }}', '{{ payment.payment_purpose.id }}')">Edit</button>
                                                <button type="button" class="btn btn-danger btn-sm" onclick="if(confirm('Are you sure?')){ window.location.href='{% url 'contracts:delete_payment' payment.id %}'; }">Delete</button>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                <hr>
                                <!-- Service Fees Section -->
                                <div class="d-flex justify-content-between align-items-center mt-4">
                                    <h6>Service Fees:</h6>
                                    <!-- Hidden input for storing contract ID -->
                                    <input type="hidden" id="contractId" name="contractId" value="{{ contract.contract_id }}">
                                </div>
                                <table id="service-fee-table" class="table service-fees-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Fee Type</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for fee in contract.servicefees.all %}
                                        <tr>
                                            <td>{{ fee.name }}</td>
                                            <td>{{ fee.description }}</td>
                                            <td>{{ fee.fee_type }}</td>
                                            <td>${{ fee.amount|floatformat:2 }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Sales Tab -->
                        <div class="tab-pane fade" id="sales" role="tabpanel" aria-labelledby="sales-tab">
                            <!-- Financial Content -->
                            <div class="financial-content">
                                <!-- Services Section -->
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Service</th>
                                            <th class="text-right">Totals</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Service Rows -->
                                        <tr>
                                            <td>Photography</td>
                                            <td class="text-right">${{ photography_cost }}</td>
                                        </tr>
                                        <tr>
                                            <td>Videography</td>
                                            <td class="text-right">${{ videography_cost }}</td>
                                        </tr>
                                        <tr>
                                            <td>DJ</td>
                                            <td class="text-right">${{ dj_cost }}</td>
                                        </tr>
                                        <tr>
                                            <td>Photobooth</td>
                                            <td class="text-right">${{ photobooth_cost }}</td>
                                        </tr>
                                        <!-- Separator -->
                                        <tr style="background-color: #f2f2f2;">
                                            <td colspan="2"><strong>Discounts</strong></td>
                                        </tr>
                                        <!-- Discounts and Totals -->
                                        <tr>
                                            <td>Package Discount: ${{ contract.calculate_package_discount }}</td>
                                            <td class="text-right">Subtotal: ${{ contract.calculate_total_service_cost }}</td>
                                        </tr>
                                        <tr>
                                            <td>Sunday Discount: ${{ contract.calculate_sunday_discount }}</td>
                                            <td class="text-right">Service Discounts: -${{ contract.calculate_discount }}</td>
                                        </tr>
                                        <tr>
                                            <td>Other Discount: ${{ contract.other_discounts_total }}</td>
                                            <td class="text-right">Service Total after Discounts: ${{ contract.calculate_total_service_cost_after_discounts }}</td>
                                        </tr>
                                        <!-- Products Section -->
                                        <tr style="background-color: #f2f2f2;">
                                            <td colspan="2"><strong>Products</strong></td>
                                        </tr>
                                        <tr>
                                            <td>Products Total: ${{ contract.calculate_product_subtotal|floatformat:2 }}</td>
                                            <td class="text-right">Tax: ${{ contract.calculate_tax|floatformat:2 }}</td>
                                        </tr>
                                        <tr>
                                            <td>Service Fees: ${{ contract.calculate_total_service_fees|floatformat:2 }}</td>
                                            <td class="text-right"><strong>Contract Total: ${{ contract.calculate_total_cost|floatformat:2 }}</strong></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                    <!-- Messages Tab Content -->
                    <div class="tab-pane fade" id="communication" role="tabpanel" aria-labelledby="communication-tab">
                        <h5>Tasks</h5>
                        <div id="contractDetailPage">
                        <!-- Task List Container -->
                            <div id="taskListContainer">
                                <table class="table table-striped" style="font-size: 10pt;">
                                    <thead>
                                        <tr>
                                            <th style="height: 30px;">Sender</th>
                                            <th style="height: 30px;">Assigned</th>
                                            <th style="height: 30px;">Note</th>
                                            <th style="height: 30px;">Due Date</th>
                                            <th style="height: 30px;">Description</th>
                                            <th style="height: 30px;">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% include 'contracts/task_list_snippet.html' %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Button to trigger the message creation modal -->
                        <button type="button" class="btn btn-dusty-pink mb-3" data-toggle="modal" data-target="#createMessageModal">
                            Create Message
                        </button>

                        <button type="button" class="btn btn-dusty-pink mb-3" data-toggle="modal" data-target="#addTaskModal"
                                data-sender-id="{{ request.user.id }}"
                                data-contract-id="{{ contract.contract_id }}"
                                data-note-id=""
                                data-type="contract">Add Task</button>

                        <div id="communicationMessagesContainer">
                            {% for type, messages in messages_by_type.items %}
                                <h5>{{ type|title }} Messages</h5>
                                {% for message in messages %}
                                    <div class="message">
                                        <p><strong>ID:</strong> {{ message.id }}</p>
                                        <p><strong>From:</strong> {{ message.created_by.username }}</p>
                                        <p><strong>Date:</strong> {{ message.created_at }}</p>
                                        <p>{{ message.content }}</p>
                                        <button type="button" class="btn btn-dusty-pink" data-toggle="modal" data-target="#addTaskModal"
                                                data-sender-id="{{ request.user.id }}"
                                                data-contract-id="{{ contract.contract_id }}"
                                                data-note-id="{{ message.id }}"
                                                data-type="internal">Add Task</button>
                                    </div>
                                {% endfor %}
                            {% endfor %}
                        </div>
                    </div>
                    <!-- Change Log tab content -->
                    <div class="tab-pane fade" id="changelog">
                        <div class="table-responsive">
                            <table class="table-bordered">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>User</th>
                                        <th>Description</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for log in changelogs %}
                                    <tr>
                                        <td>{{ log.timestamp | date:"Y-m-d H:i:s" }}</td>
                                        <td>{{ log.user.get_full_name }}</td>
                                        <td>{{ log.description }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr><td colspan="3">No changes logged yet.</td></tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div> <!-- Closes the tab-content div for financial tabs -->
        </div>
    </div>    <!-- Closes the overarching div, if this is meant to close the container for all content above, ensure its opening tag is correctly placed -->

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <!-- Include Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- Your custom script for handling tabs -->
<script>
    $(document).ready(function() {
        var hash = window.location.hash;
        if (hash) {
            var hashParts = hash.split('/');
            var mainHash = hashParts[0];
            var subHash = hashParts.length > 1 ? '#' + hashParts[1] : null;

            // Activate main tab
            $('.nav-tabs a[href="' + mainHash + '"]').tab('show');

            // Activate nested service tab if present
            if (subHash) {
                $('.nav-tabs a[href="' + subHash + '"]').tab('show');
            }
        }

        $('.nav-tabs a').on('click', function(e) {
            window.location.hash = this.hash;
        });

        // Ensure the tab state is maintained after page refresh
        $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
            if (e.target.hash.startsWith('#services')) {
                window.location.hash = e.target.hash.split('#')[1] + '/' + e.relatedTarget.hash.split('#')[1];
            } else {
                window.location.hash = e.target.hash;
            }
        });
    });
</script>


    <script>
        let contractData = {
            servicesTotalAfterDiscounts: {{ contract.calculate_total_service_cost_after_discounts }},
            totalContractAmount: {{ contract.calculate_total_cost }},
            eventDate: '{{ contract.event_date|date:"Y-m-d" }}',
            paymentScheduleId: {{ schedule_id|default:"null" }},        };
    </script>

<!-- Modal HTML -->
<div class="modal fade" id="bookingModal" tabindex="-1" role="dialog" aria-labelledby="bookingModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bookingModalLabel">Book Staff</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'contracts:manage_staff_assignments' id=contract.contract_id %}" id="bookingForm">
                    {% csrf_token %}
                    <input type="hidden" id="id_booking_id" name="booking_id" value="">
                    <input type="hidden" name="next" value="{{ request.path }}#services">
                    {{ booking_form.as_p }}
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-close" data-dismiss="modal">Close</button>
                <button type="submit" class="btn-dusty-pink" id="submitBooking">Book</button>
                <button type="submit" class="btn-dusty-pink" id="updateBooking">Update</button>
                <button type="button" class="btn btn-danger btn-sm" id="deleteBooking">Delete</button>
            </div>
        </div>
    </div>
</div>



<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" role="dialog" aria-labelledby="paymentModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="paymentModalLabel"> Add/Edit Payment</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="payment-form" method="post">
          <input type="hidden" id="payment-id" name="payment_id">
          <input type="hidden" id="payment-action" name="payment_action">
          <input type="hidden" id="original-amount" value="">
          <div class="form-group">
            <label for="amount">Amount:</label>
            <input type="number" class="form-control" id="amount" name="amount" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="payment_method">Payment Method:</label>
            <select class="form-control" id="payment_method" name="payment_method">
              <option value="CASH">Cash</option>
              <option value="CHECK">Check</option>
              <option value="CREDIT_CARD">Credit Card</option>
              <option value="ZELLE">Zelle</option>
              <option value="VENMO">Venmo</option>
            </select>
          </div>
          <div class="form-group">
            <label for="payment_purpose">Payment Purpose:</label>
            <select class="form-control" id="payment_purpose" name="payment_purpose">
              <!-- Assuming payment purposes are loaded dynamically -->
              {% for purpose in payment_purposes %}
              <option value="{{ purpose.id }}">{{ purpose.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
              <label for="memo">Memo:</label>
              <input type="text" class="form-control" id="memo" name="memo" placeholder="Enter a note or memo">
          </div>
          <div class="form-group">
              <label for="payment_reference">Reference:</label>
              <input type="text" class="form-control" id="payment_reference" name="payment_reference" placeholder="Enter a reference number">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-close" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-dusty-pink" onclick="confirmPayment()">Confirm Payment</button>
      </div>
    </div>
  </div>
</div>


<!-- Add Schedule Modal -->
<div class="modal fade" id="scheduleModal" tabindex="-1" role="dialog" aria-labelledby="scheduleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="scheduleModalLabel">Add or Update Schedule</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm" method="post" action="{% url 'contracts:create_or_update_schedule' contract_id=contract.contract_id %}">
                    {% csrf_token %}
                    {{ schedule_payment_formset.management_form }}
                    <hr>
                    {{ schedule_form.as_p }}
                    <hr>
                    <!-- Empty Payment Form (used for cloning) -->
                    <div class="payment-form empty-payment-form" style="display: none;">
                        {{ schedule_payment_formset.empty_form.as_p }}
                    </div>
                    <hr>
                    <div id="paymentScheduleEntries">
                        {% for form in schedule_payment_formset %}
                            <div class="payment-form mb-3">
                                <div class="form-check form-check-inline">
                                    <input type="checkbox" class="form-check-input edit-toggle" id="edit_{{ forloop.counter }}" onclick="toggleEdit(this)">
                                    <label for="edit_{{ forloop.counter }}" class="form-check-label ml-2 mb-0">Enable Editing</label>
                                </div>
                                <div class="form-fields mt-2" id="form_fields_{{ forloop.counter }}">
                                    {{ form.as_p }}
                                </div>
                            </div>
                            <hr>
                        {% endfor %}
                    </div>
                    <button type="button" class="btn btn-dusty-pink" onclick="addFormsetEntry('paymentScheduleEntries', 'id_schedule_payments-TOTAL_FORMS', '.payment-form')">Add Payment Entry</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-close" data-dismiss="modal">Close</button>
                <button type="submit" class="btn-dusty-pink" form="scheduleForm" onclick="enableAllInputs()">Save changes</button>
            </div>
        </div>
    </div>
</div>



<!-- Service Fee Modal -->
<div class="modal fade" id="serviceFeeModal" tabindex="-1" role="dialog" aria-labelledby="serviceFeeModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="serviceFeeModalLabel">Add or Update Service Fees</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: black; background-color: white;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="serviceFeeForm" method="post" action="{% url 'contracts:add_service_fee' contract_id=contract.contract_id %}">
                    {% csrf_token %}
                    {{ service_fee_formset.management_form }}
                    <hr>
                    <!-- Empty Service Fee Form (used for cloning) -->
                    <div class="service-fee-form empty-service-fee-form" style="display: none;">
                        {{ service_fee_formset.empty_form.as_p }}
                    </div>
                    <hr>
                    <div id="serviceFeeEntries">
                        {% for form in service_fee_formset %}
                            <div class="service-fee-form mb-3">
                                <div class="form-check form-check-inline">
                                    <input type="checkbox" class="form-check-input edit-toggle" id="edit_fee_{{ forloop.counter }}" onclick="toggleEdit(this)">
                                    <label for="edit_fee_{{ forloop.counter }}" class="form-check-label ml-2 mb-0">Enable Editing</label>
                                </div>
                                <div class="form-fields mt-2" id="form_fields_fee_{{ forloop.counter }}">
                                    {{ form.as_p }}
                                </div>
                            </div>
                            <hr>
                        {% endfor %}
                    </div>
                    <button type="button" class="btn btn-dusty-pink" onclick="addFormsetEntry('serviceFeeEntries', 'id_servicefees-TOTAL_FORMS', '.service-fee-form')">Add Service Fee Entry</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-close" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-dusty-pink" form="serviceFeeForm" onclick="enableAllInputs()">Save changes</button>
            </div>
        </div>
    </div>
</div>



<!-- Message Creation Modal -->
<div class="modal fade" id="createMessageModal" tabindex="-1" role="dialog" aria-labelledby="createMessageModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createMessageModalLabel">Create Message</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form method="post" id="createMessageForm">
          {% csrf_token %}
          {{ communication_form.as_p }}
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-close" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-dusty-pink" form="createMessageForm">Send Message</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Task Modal -->
<div class="modal fade" id="addTaskModal" tabindex="-1" role="dialog" aria-labelledby="taskModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="taskModalLabel">Add Task</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Task Form -->
        <form method="post" id="addTaskForm" data-create-task-url="{% url 'contracts:create_contract_task' %}">
            {% csrf_token %}
            {{ task_form.as_p }}
            <input type="hidden" id="id_type" name="type" value="contract">
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-close" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-dusty-pink" form="addTaskForm">Save Task</button>
      </div>
    </div>
  </div>
</div>




<!-- Special Terms Modal -->
<div class="modal fade" id="customTextModal" tabindex="-1" role="dialog" aria-labelledby="customTextModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="customTextModalLabel">Custom Contract Terms and Conditions</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <textarea id="modalCustomText" class="form-control" rows="10"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-close" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-dusty-pink" id="saveCustomText">Save</button>
            </div>
        </div>
    </div>
</div>
</body>


<script>
    // Initialize DjangoFilters as an empty object if it doesn't already exist
    var DjangoFilters = DjangoFilters || {};

    // JavaScript function to round up to the nearest 100
    DjangoFilters['roundup_to_nearest_100'] = function(value) {
        return Math.ceil(value / 100) * 100;
    };

    // JavaScript function to subtract days from a date
    DjangoFilters['subtract_days'] = function(dateString, days) {
        var date = new Date(dateString);
        date.setDate(date.getDate() - days);
        return date.toISOString().split('T')[0];
    };
</script>

<!-- Include Moment.js from a CDN before your script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<!-- Common script -->

    <!-- Include your script here -->
<script type="module" src="{% static '***REMOVED***.js' %}"></script>
<script type="module" src="{% static 'contracts/js/PhotographyMgmt.js' %}"></script>
<script type="module" src="{% static 'contracts/js/eventStaffManagement.js' %}"></script>
<script src="{% static 'contracts/js/ContractEdit.js' %}"></script>
<script src="{% static 'contracts/js/moneyMgmt.js' %}" defer></script>

</html>
{% endblock content %}