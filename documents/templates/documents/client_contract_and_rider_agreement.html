<!DOCTYPE html>
<html>
{% load static %}
<head>
    <title>Contract Agreement</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
   <style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        margin: 0;
    }

    .contract-header {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .column {
        flex: 1;
        min-width: 100px;
    }

    .contact-info {
        display: flex;
        justify-content: space-between;
        width: 100%;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .office-info {
        text-align: left;
        font-size: 9pt;
        flex: 1;
    }
    .address-info {
        text-align: right;
        font-size: 9pt;
        flex: 1;
    }
    .agreement-description {
        font-size: 12pt;
        text-align: center;
        margin-top: 5px;
    }
    .agreement-engage {
        font-size: 9pt;
        margin-top: 5px;
        text-align: center;
    }

    .divider {
        border-top: 1px solid #000;
        margin: 20px 0;
    }

    .text-box {
        border: 1px solid #000;
        min-height: 40px;
        margin-bottom: 20px;
        padding: 10px;
    }

    .logo {
        width: 100%;
        text-align: center;
    }
    .logo img {
        width: 250px;
        height: auto;
    }

.agreement-details {
    font-size: 9pt;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 10px 10px;
    background-color: #f4f4f4; /* Light gray background */
    border-radius: 8px; /* Rounded corners for the whole section */
    border: 1px solid #ddd; /* Border around the section */
    box-sizing: border-box; /* Prevent the padding from affecting layout */
}

.left-column, .right-column {
    width: 48%; /* Take up nearly half the space */
}

.client-info-box, .ceremony-reception-box {
    background-color: #fff;
    padding: 10px 10px; /* Reduced padding for a more compact look */
    border-radius: 12px; /* Rounded corners for boxes */
    border: 1px solid #ddd; /* Light border around boxes */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Subtle shadow */
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* Align content to the top */
    height: auto; /* Let the box grow to fit the content */
}

.info-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px; /* Reduced margin between rows */
}

.info-row strong {
    font-size: 12px;
    color: #333;
}

.info-row span {
    font-size: 12px;
    color: #555;
}

.ceremony-reception-box .info-row {
    text-align: left; /* Align text to left for other fields */
}

.ceremony-reception-box .info-row span {
    text-align: right; /* Align the city/state to the right */
}

@media (max-width: 600px) {
    .agreement-details {
        flex-direction: column;
        align-items: center;
    }

    .left-column, .right-column {
        width: 100%;
        margin-bottom: 20px;
    }

    .client-info-box, .ceremony-reception-box {
        width: 100%;
    }
}

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
        vertical-align: top;
    }

    th {
        background-color: #f2f2f2;
        font-size: 13px;
    }

    td {
        font-size: 12px;
    }

    tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    tr:hover {
        background-color: #ddd;
    }

    .default-text {
        font-size: 9pt;
        font-style: italic;
    }

    .signature-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
    }
    .signature-section {
        flex: 1;
        margin: 0 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .signature-section label {
        padding-bottom: 10px;
    }
    .signature-section canvas, .signature-placeholder {
        border: 1px solid #000;
        width: 100%;
        height: 100px;
    }
    .signature-section button {
        margin-top: 10px;
    }
    .main-signature-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 20px;
    }
    .main-signature-section label {
        margin-bottom: 10px;
    }
    .main-signature-section canvas {
        border: 1px solid #000;
        width: 400px;
        height: 100px;
    }
    .main-signature-section button {
        margin-top: 10px;
    }
    .rider-inputs {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        margin-bottom: 20px;
    }
    .rider-inputs label {
        width: 100%;
        margin-top: 10px;
    }
    .rider-inputs input {
        width: calc(50% - 20px);
        max-width: 400px;
        margin-bottom: 10px;
    }

    .submit-btn {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        display: block;
        width: 100%;
        max-width: 300px;
        margin: 20px auto;
        background-color: #d9727a;
        color: white;
        border: none;
        border-radius: 5px;
    }

    .submit-btn:hover {
        background-color: #ebcdc3; /* Darker dusty pink for hover */
        color: white; /* Change text color on hover */
        text-decoration: none; /* Remove underline */
    }

    .rider-text {
        font-size: 7pt;
    }
    @media (max-width: 600px) {
        .agreement-details {
            flex-direction: column;
            align-items: center;
        }

        .left-column, .right-column {
            width: 100%;
            margin-bottom: 20px;
        }

        .client-info-box, .ceremony-reception-box {
            width: 100%;
        }
    }

    </style>
</head>
<body>
<form id="contract-form" method="post" action="{% url 'documents:client_contract_and_rider_agreement' contract.contract_id %}">
    {% csrf_token %}
    {% load group_tags %}
    <!-- Header Section -->
    {% include "documents/contract_agreements/partials/header.html" %}

    <div class="divider"></div>

    <!-- Contract Agreement Description -->
    <!-- Agreement Section -->
    <div class="agreement-description">
        <strong>Contractual Agreement</strong>
    </div>
    <div class="agreement-engage">
        <p>I (we) hereby engage Essence Weddings to render services as follows:</p>
    </div>

    <!-- Agreement Details (Client and Event Info) -->
    <div class="agreement-details">
        <div class="left-column">
            <div class="client-info-box">
                <div class="info-row">
                    <strong>Primary Contact:</strong>
                    <span>{{ contract.client.primary_contact }}</span>
                </div>
                <div class="info-row">
                    <strong>Email:</strong>
                    <span>{{ contract.client.primary_email }}</span>
                </div>
                <div class="info-row">
                    <strong>Phone:</strong>
                    <span>{{ contract.client.primary_phone1 }}</span>
                </div>
                {% if contract.client.partner_contact %}
                    <div class="info-row">
                        <strong>Partner Contact:</strong>
                        <span>{{ contract.client.partner_contact }}</span>
                    </div>
                {% endif %}
            </div>
        </div>
        <div class="right-column">
            <div class="ceremony-reception-box">
                <div class="info-row">
                    <strong>Contract No.:</strong>
                    <span>{{ contract.custom_contract_number }}</span>
                </div>
                <div class="info-row">
                    <strong>Wedding Date:</strong>
                    <span>{{ contract.event_date }}</span>
                </div>
                <div class="info-row">
                    <strong>Ceremony Site:</strong>
                    <span>{{ contract.ceremony_site }}</span>
                </div>
                <div class="info-row">
                    <strong>Reception Site:</strong>
                    <span>{{ contract.reception_site }}</span>
                </div>
            </div>
        </div>
    </div>


    <div class="agreement-details">
        <div class="left-column">
            <p>
                <label for="photographer_choice">Photographer Choice:</label><br>
                <select id="photographer_choice" name="photographer_choice" style="width: 100%;">
                    <option value="" disabled selected>Choose your photographer</option>
                    {% for photographer in photographer_choices %}
                        <option value="{{ photographer.id }}" {% if contract_agreement.photographer_choice == photographer %}selected{% endif %}>
                            {{ photographer.get_full_name }}
                        </option>
                    {% endfor %}
                </select>
            </p>
        </div>
    </div>

    <div class="divider"></div>

    <!-- Service Details Table -->
    {% include "documents/contract_agreements/partials/service_details_table.html" %}

    <div class="divider"></div>

    <!-- Product Details Table -->
    {% include "documents/contract_agreements/partials/product_details_table.html" %}

    <!-- Formalwear Details Table -->
    {% include "documents/contract_agreements/partials/formalwear_details_table.html" %}

    <!-- Service Fees Table -->
    {% include "documents/contract_agreements/partials/service_fees_table.html" %}

    <!-- discounts Table -->
    {% include "documents/contract_agreements/partials/discounts.html" %}
    <div class="divider"></div>

    <!-- Summary Details -->
    {% include "documents/contract_agreements/partials/summary_details.html" %}

    <div class="divider"></div>


    <!-- Custom text area -->
    <div class="text-box">
        {{ contract.custom_text|default_if_none:"" }}
    </div>

<!-- Main Contract Signature -->
<div class="main-signature-section">
    <label for="signature-pad-main">Signature for Contractual Agreement:</label>
    <canvas id="signature-pad-main" width="400" height="100"></canvas>
    <button type="button" onclick="clearSignaturePad('main')">Clear</button>
</div>
<input type="hidden" id="main_signature" name="main_signature">

{% if show_riders %}

    <!-- Photography Package Rider Agreement -->
    {% if contract.photography_package %}
    <div class="page-break"></div>
    <div>
        <h2 style="text-align: center;">Photography Package Rider Agreement</h2>
        <div class="rider-text">{{ rider_texts.photography|safe }}</div>
        <input type="hidden" name="rider_text_photography" value="{{ rider_texts.photography }}">
        <div class="rider-inputs">
            <label for="client_name_photography">Client Name (Print):</label>
            <input type="text" id="client_name_photography" name="client_name_photography" required>
            <label for="agreement_date_photography">Date:</label>
            <input type="date" id="agreement_date_photography" name="agreement_date_photography" required>
        </div>
        <div class="signature-wrapper">
            <div class="signature-section">
                <label for="signature-pad-photography">Signature for Photography Package:</label>
                <canvas id="signature-pad-photography" width="400" height="100"></canvas>
                <button type="button" onclick="clearSignaturePad('photography')">Clear</button>
            </div>
            <div class="signature-section">
                <label for="essence-rep-signature-photography">Essence Rep Signature:</label>
                <div id="essence-rep-signature-photography" class="signature-placeholder"></div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Additional Photography Rider Agreement -->
    {% if contract.photography_additional %}
    <div class="page-break"></div>
    <div>
        <h2 style="text-align: center;">Additional Photography Rider Agreement</h2>
        <div class="rider-text">{{ rider_texts.photography_additional|safe }}</div>
        <input type="hidden" name="rider_text_photography_additional" value="{{ rider_texts.photography_additional }}">
        <div class="rider-inputs">
            <label for="client_name_photography_additional">Client Name (Print):</label>
            <input type="text" id="client_name_photography_additional" name="client_name_photography_additional" required>
            <label for="agreement_date_photography_additional">Date:</label>
            <input type="date" id="agreement_date_photography_additional" name="agreement_date_photography_additional" required>
        </div>
        <div class="signature-wrapper">
            <div class="signature-section">
                <label for="signature-pad-photography-additional">Signature for Additional Photography:</label>
                <canvas id="signature-pad-photography-additional" width="400" height="100"></canvas>
                <button type="button" onclick="clearSignaturePad('photography_additional')">Clear</button>
            </div>
            <div class="signature-section">
                <label for="essence-rep-signature-photography-additional">Essence Rep Signature:</label>
                <div id="essence-rep-signature-photography-additional" class="signature-placeholder"></div>
            </div>
        </div>
    </div>
    {% endif %}


    <!-- Videography Package Rider Agreement -->
    {% if contract.videography_package %}
    <div class="page-break"></div>
    <div>
        <h2 style="text-align: center;">Videography Package Rider Agreement</h2>
        <div class="rider-text">{{ rider_texts.videography|safe }}</div>
        <input type="hidden" name="rider_text_videography" value="{{ rider_texts.videography }}">
        <div class="rider-inputs">
            <label for="client_name_videography">Client Name (Print):</label>
            <input type="text" id="client_name_videography" name="client_name_videography" required>
            <label for="agreement_date_videography">Date:</label>
            <input type="date" id="agreement_date_videography" name="agreement_date_videography" required>
        </div>
        <div class="signature-wrapper">
            <div class="signature-section">
                <label for="signature-pad-videography">Signature for Videography Package:</label>
                <canvas id="signature-pad-videography" width="400" height="100"></canvas>
                <button type="button" onclick="clearSignaturePad('videography')">Clear</button>
            </div>
            <div class="signature-section">
                <label for="essence-rep-signature-videography">Essence Rep Signature:</label>
                <div id="essence-rep-signature-videography" class="signature-placeholder"></div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Additional Videography Rider Agreement -->
    {% if contract.videography_additional %}
    <div class="page-break"></div>
    <div>
        <h2 style="text-align: center;">Additional Videography Rider Agreement</h2>
        <div class="rider-text">{{ rider_texts.videography_additional|safe }}</div>
        <input type="hidden" name="rider_text_videography_additional" value="{{ rider_texts.videography_additional }}">
        <div class="rider-inputs">
            <label for="client_name_videography_additional">Client Name (Print):</label>
            <input type="text" id="client_name_videography_additional" name="client_name_videography_additional" required>
            <label for="agreement_date_videography_additional">Date:</label>
            <input type="date" id="agreement_date_videography_additional" name="agreement_date_videography_additional" required>
        </div>
        <div class="signature-wrapper">
            <div class="signature-section">
                <label for="signature-pad-videography-additional">Signature for Additional Videography:</label>
                <canvas id="signature-pad-videography-additional" width="400" height="100"></canvas>
                <button type="button" onclick="clearSignaturePad('videography_additional')">Clear</button>
            </div>
            <div class="signature-section">
                <label for="essence-rep-signature-videography-additional">Essence Rep Signature:</label>
                <div id="essence-rep-signature-videography-additional" class="signature-placeholder"></div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- DJ Package Rider Agreement -->
    {% if contract.dj_package %}
    <div class="page-break"></div>
    <div>
        <h2 style="text-align: center;">DJ Package Rider Agreement</h2>
        <div class="rider-text">{{ rider_texts.dj|safe }}</div>
        <input type="hidden" name="rider_text_dj" value="{{ rider_texts.dj }}">
        <div class="rider-inputs">
            <label for="client_name_dj">Client Name (Print):</label>
            <input type="text" id="client_name_dj" name="client_name_dj" required>
            <label for="agreement_date_dj">Date:</label>
            <input type="date" id="agreement_date_dj" name="agreement_date_dj" required>
        </div>
        <div class="signature-wrapper">
            <div class="signature-section">
                <label for="signature-pad-dj">Signature for DJ Package:</label>
                <canvas id="signature-pad-dj" width="400" height="100"></canvas>
                <button type="button" onclick="clearSignaturePad('dj')">Clear</button>
            </div>
            <div class="signature-section">
                <label for="essence-rep-signature-dj">Essence Rep Signature:</label>
                <div id="essence-rep-signature-dj" class="signature-placeholder"></div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Additional DJ Rider Agreement -->
    {% if contract.dj_additional %}
    <div class="page-break"></div>
    <div>
        <h2 style="text-align: center;">Additional DJ Rider Agreement</h2>
        <div class="rider-text">{{ rider_texts.dj_additional|safe }}</div>
        <input type="hidden" name="rider_text_dj_additional" value="{{ rider_texts.dj_additional }}">
        <div class="rider-inputs">
            <label for="client_name_dj_additional">Client Name (Print):</label>
            <input type="text" id="client_name_dj_additional" name="client_name_dj_additional" required>
            <label for="agreement_date_dj_additional">Date:</label>
            <input type="date" id="agreement_date_dj_additional" name="agreement_date_dj_additional" required>
        </div>
        <div class="signature-wrapper">
            <div class="signature-section">
                <label for="signature-pad-dj-additional">Signature for Additional DJ:</label>
                <canvas id="signature-pad-dj-additional" width="400" height="100"></canvas>
                <button type="button" onclick="clearSignaturePad('dj_additional')">Clear</button>
            </div>
            <div class="signature-section">
                <label for="essence-rep-signature-dj-additional">Essence Rep Signature:</label>
                <div id="essence-rep-signature-dj-additional" class="signature-placeholder"></div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Photobooth Package Rider Agreement -->
    {% if contract.photobooth_package %}
    <div class="page-break"></div>
    <div>
        <h2 style="text-align: center;">Photobooth Package Rider Agreement</h2>
        <div class="rider-text">{{ rider_texts.photobooth|safe }}</div>
        <input type="hidden" name="rider_text_photobooth" value="{{ rider_texts.photobooth }}">
        <div class="rider-inputs">
            <label for="client_name_photobooth">Client Name (Print):</label>
            <input type="text" id="client_name_photobooth" name="client_name_photobooth" required>
            <label for="agreement_date_photobooth">Date:</label>
            <input type="date" id="agreement_date_photobooth" name="agreement_date_photobooth" required>
        </div>
        <div class="signature-wrapper">
            <div class="signature-section">
                <label for="signature-pad-photobooth">Signature for Photobooth Package:</label>
                <canvas id="signature-pad-photobooth" width="400" height="100"></canvas>
                <button type="button" onclick="clearSignaturePad('photobooth')">Clear</button>
            </div>
            <div class="signature-section">
                <label for="essence-rep-signature-photobooth">Essence Rep Signature:</label>
                <div id="essence-rep-signature-photobooth" class="signature-placeholder"></div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Additional Photobooth Rider Agreement -->
    {% if contract.photobooth_additional %}
    <div class="page-break"></div>
    <div>
        <h2 style="text-align: center;">Additional Photobooth Rider Agreement</h2>
        <div class="rider-text">{{ rider_texts.photobooth_additional|safe }}</div>
        <input type="hidden" name="rider_text_photobooth_additional" value="{{ rider_texts.photobooth_additional }}">
        <div class="rider-inputs">
            <label for="client_name_photobooth_additional">Client Name (Print):</label>
            <input type="text" id="client_name_photobooth_additional" name="client_name_photobooth_additional" required>
            <label for="agreement_date_photobooth_additional">Date:</label>
            <input type="date" id="agreement_date_photobooth_additional" name="agreement_date_photobooth_additional" required>
        </div>
        <div class="signature-wrapper">
            <div class="signature-section">
                <label for="signature-pad-photobooth-additional">Signature for Additional Photobooth:</label>
                <canvas id="signature-pad-photobooth-additional" width="400" height="100"></canvas>
                <button type="button" onclick="clearSignaturePad('photobooth_additional')">Clear</button>
            </div>
            <div class="signature-section">
                <label for="essence-rep-signature-photobooth-additional">Essence Rep Signature:</label>
                <div id="essence-rep-signature-photobooth-additional" class="signature-placeholder"></div>
            </div>
        </div>
    </div>
    {% endif %}

{% endif %}
    <!-- Hidden input for main signature -->
    <input type="hidden" name="signature_photography" id="signature_photography">
    <input type="hidden" name="signature_photography_additional" id="signature_photography_additional">
    <input type="hidden" name="signature_videography" id="signature_videography">
    <input type="hidden" name="signature_videography_additional" id="signature_videography_additional">
    <input type="hidden" name="signature_dj" id="signature_dj">
    <input type="hidden" name="signature_dj_additional" id="signature_dj_additional">
    <input type="hidden" name="signature_photobooth" id="signature_photobooth">
    <input type="hidden" name="signature_photobooth_additional" id="signature_photobooth_additional">

    <!-- Submit Button -->
    <div style="text-align: center; margin-top: 20px;">
        <input type="submit" value="Submit Agreement" class="submit-btn">
    </div>
</form>

<!-- Include modal in the HTML -->
<div id="successModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <p>Contract submitted successfully!</p>
    </div>
</div>

<style>

.modal {
    display: none;
    position: fixed;
    z-index: 1;
    padding-top: 100px;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgb(0,0,0);
    background-color: rgba(0,0,0,0.4);
}

.modal-content {
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
</style>

<script>
    // Object to store our signature pad instances
    var signaturePads = {};

    function initializeSignaturePads() {
        // Select all canvases whose id starts with "signature-pad-"
        var padElements = document.querySelectorAll('canvas[id^="signature-pad-"]');
        padElements.forEach(function (canvas) {
            // Create a key by removing the prefix and replacing dashes with underscores.
            var padName = canvas.id.replace('signature-pad-', '').replace(/-/g, '_');
            // Initialize SignaturePad on the canvas
            var signaturePad = new SignaturePad(canvas);
            resizeCanvas(canvas);
            // Store the instance in our signaturePads object using the normalized key
            signaturePads[padName] = signaturePad;
        });
    }

    // Resize canvas for proper responsiveness
    function resizeCanvas(canvas) {
        var ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;
        canvas.getContext("2d").scale(ratio, ratio);
    }

    // Reinitialize canvas sizes on window resize
    window.addEventListener('resize', function () {
        for (var padName in signaturePads) {
            if (signaturePads.hasOwnProperty(padName)) {
                resizeCanvas(signaturePads[padName].canvas);
            }
        }
    });

    // Initialize signature pads once the DOM content is loaded
    document.addEventListener('DOMContentLoaded', function () {
        initializeSignaturePads();
    });

    // On form submit, save signature data to hidden inputs
    document.getElementById('contract-form').onsubmit = function (e) {
        // Example check: ensure the main signature is not empty.
        if (signaturePads['main'] && signaturePads['main'].isEmpty()) {
            alert('Please provide your signature for the main contract.');
            e.preventDefault();
            return false;
        }

        // Set the hidden input values for each signature
        if (signaturePads['main']) {
            document.getElementById('main_signature').value = signaturePads['main'].toDataURL();
        }
        if (signaturePads['photography'] && document.getElementById('signature_photography')) {
            document.getElementById('signature_photography').value = signaturePads['photography'].toDataURL();
        }
        if (signaturePads['photography_additional'] && document.getElementById('signature_photography_additional')) {
            document.getElementById('signature_photography_additional').value = signaturePads['photography_additional'].toDataURL();
        }
        if (signaturePads['videography'] && document.getElementById('signature_videography')) {
            document.getElementById('signature_videography').value = signaturePads['videography'].toDataURL();
        }
        if (signaturePads['videography_additional'] && document.getElementById('signature_videography_additional')) {
            document.getElementById('signature_videography_additional').value = signaturePads['videography_additional'].toDataURL();
        }
        if (signaturePads['dj'] && document.getElementById('signature_dj')) {
            document.getElementById('signature_dj').value = signaturePads['dj'].toDataURL();
        }
        if (signaturePads['dj_additional'] && document.getElementById('signature_dj_additional')) {
            document.getElementById('signature_dj_additional').value = signaturePads['dj_additional'].toDataURL();
        }
        if (signaturePads['photobooth'] && document.getElementById('signature_photobooth')) {
            document.getElementById('signature_photobooth').value = signaturePads['photobooth'].toDataURL();
        }
        if (signaturePads['photobooth_additional'] && document.getElementById('signature_photobooth_additional')) {
            document.getElementById('signature_photobooth_additional').value = signaturePads['photobooth_additional'].toDataURL();
        }

        return true;
    };

    // Function to clear a specific signature pad by its normalized key
    function clearSignaturePad(padName) {
        if (signaturePads[padName]) {
            signaturePads[padName].clear();
        }
    }
</script>
</body>
</html>
