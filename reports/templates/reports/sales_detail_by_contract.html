{% extends "base.html" %}
{% load app_filters %}

{% block content %}
<div class="outer-container">
    <div class="search-results">
        <h4>Sales Detail by Contract</h4>
        <button onclick="history.back()" class="btn-dusty-pink">Go Back</button>
        <div class="search-results">
            <h6>Contract Breakdown from {{ start_date }} to {{ end_date }} for
                {% if selected_location == 'all' %}all locations{% else %}{{ locations|get_location_name:selected_location }}{% endif %}
            </h6>
            <table>
                <thead>
                    <tr>
                        <th>Contract Number</th>
                        <th>Location</th>
                        <th>Service Sales</th>
                        <th>Product Sales</th>
                        <th>Taxable Products</th>
                        <th>Sales Tax</th>
                        <th>Other Charges</th>
                        <th>Total Sales w/ Tax</th>
                    </tr>
                </thead>
                <tbody>
                    {% if contract_data %}
                        {% for data in contract_data %}
                        <tr>
                            <td><a href="{% url 'contracts:contract_detail' data.contract_id %}">{{ data.custom_contract_number }}</a></td>
                            <td>{{ data.location }}</td>
                            <td>${{ data.service_revenue|floatformat:2 }}</td>
                            <td>${{ data.products_revenue|floatformat:2 }}</td>
                            <td>${{ data.taxable_products_revenue|floatformat:2 }}</td>
                            <td>${{ data.tax_collected|floatformat:2 }}</td>
                            <td>${{ data.service_fees|floatformat:2 }}</td>
                            <td>${{ data.total_revenue|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="8">No records found for the selected criteria.</td>
                        </tr>
                    {% endif %}
                </tbody>

                <tfoot>
                    <tr>
                        <th colspan="2">Totals</th>
                        <th>${{ total_service_revenue|floatformat:2 }}</th>
                        <th>${{ total_products_revenue|floatformat:2 }}</th>
                        <th>${{ total_taxable_products_revenue|floatformat:2 }}</th>
                        <th>${{ total_tax_collected|floatformat:2 }}</th>
                        <th>${{ total_service_fees|floatformat:2 }}</th>
                        <th>${{ total_revenue|floatformat:2 }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
{% endblock %}
